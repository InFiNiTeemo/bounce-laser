#!/usr/bin/env node
/**
 * sync-community.js
 * Fetches approved community levels from the API and writes them
 * to js/communityLevels.js as an ES module for offline/GitHub Pages fallback.
 *
 * Usage: node scripts/sync-community.js
 */

const API_URL = 'https://bounce-laser.pages.dev/api/levels/sync';
const OUTPUT_PATH = 'js/communityLevels.js';

async function main() {
  console.log('Fetching community levels from', API_URL, '...');

  const res = await fetch(API_URL);
  if (!res.ok) {
    console.error(`Failed: HTTP ${res.status}`);
    process.exit(1);
  }

  const levels = await res.json();
  console.log(`Got ${levels.length} approved level(s).`);

  const code = `/**
 * communityLevels.js â€” Auto-generated by scripts/sync-community.js
 * Last synced: ${new Date().toISOString()}
 */
export const COMMUNITY_LEVELS = ${JSON.stringify(levels, null, 2)};
`;

  const fs = await import('fs');
  const path = await import('path');
  const outPath = path.default.resolve(process.cwd(), OUTPUT_PATH);
  fs.default.writeFileSync(outPath, code, 'utf8');
  console.log(`Written to ${outPath}`);
}

main().catch(err => {
  console.error('Error:', err.message);
  process.exit(1);
});
